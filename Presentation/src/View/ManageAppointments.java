/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package View;

import Domain.Appointment;
import Domain.AppointmentType;
import com.calendarfx.model.CalendarSource;
import com.calendarfx.model.Entry;
import com.calendarfx.view.page.WeekPage;
import control.AppointmentControl;
import java.awt.BorderLayout;
import java.time.LocalDate;
import com.calendarfx.model.Calendar;
import control.PatientControl;
import java.util.List;
import javafx.application.Platform;
import javafx.embed.swing.JFXPanel;
import javafx.scene.Scene;
import javafx.scene.layout.StackPane;

/**
 *
 * @author orlandocamacho
 */
public class ManageAppointments extends javax.swing.JPanel {

    /**
     * Creates new form ScheduleAppointment
     */
    public ManageAppointments() {
        initComponents();
        // this.loadPatients();
        initAndShowGUI();
    }

    private static List<Appointment> loadAppointments() {
        return AppointmentControl.getInstance().getAppointment();
    }

    private static void initAndShowGUI() {
        final JFXPanel fxPanel = new JFXPanel();
        fxPanel.setSize(weekPanel.getWidth(), weekPanel.getHeight());
        weekPanel.setLayout(new BorderLayout());
        weekPanel.add(fxPanel, BorderLayout.CENTER);

        Platform.runLater(new Runnable() {
            @Override
            public void run() {
                initFX(fxPanel);
            }
        });
    }

    private static void initFX(JFXPanel fxPanel) {
        // This method is invoked on the JavaFX thread
        Scene scene = createScene();
        fxPanel.setScene(scene);
    }

    private static Scene createScene() {
        WeekPage weekView = new WeekPage();

        CalendarSource appointmentsCalendarSource = new CalendarSource("Appointments");

        Calendar cl = new Calendar("Master");

        for (Appointment appointment : loadAppointments()) {
            Entry<String> entry = new Entry<>();
            System.out.println(PatientControl.getInstance().getPatientByID(appointment.getPatient().getID()).getName());
            entry.setTitle(PatientControl.getInstance().getPatientByID(appointment.getPatient().getID()).getName());
            entry.changeStartDate(appointment.getStartTime().toLocalDateTime().toLocalDate());
            entry.changeEndDate(appointment.getStartTime().toLocalDateTime().toLocalDate());
            entry.changeStartTime(appointment.getStartTime().toLocalDateTime().toLocalTime());
            if (appointment.getaType() == AppointmentType.Esthetic || appointment.getaType() == AppointmentType.Nutritional) {
                entry.changeEndTime(appointment.getStartTime().toLocalDateTime().toLocalTime().plusMinutes(15));
            } else {
                entry.changeEndTime(appointment.getStartTime().toLocalDateTime().toLocalTime().plusMinutes(60));
            }
            cl.addEntry(entry);
        }

        appointmentsCalendarSource.getCalendars().addAll(cl);

        weekView.getCalendarSources().addAll(appointmentsCalendarSource);

        StackPane stackPane = new StackPane();
        stackPane.getChildren().addAll(weekView);

        Scene scene = new Scene(stackPane);

        return scene;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        title = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        weekPanel = new javax.swing.JPanel();

        setBackground(new java.awt.Color(255, 255, 255));
        setMinimumSize(new java.awt.Dimension(1080, 685));
        setPreferredSize(new java.awt.Dimension(1080, 685));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        title.setBackground(new java.awt.Color(255, 255, 255));
        title.setBorder(javax.swing.BorderFactory.createMatteBorder(0, 0, 1, 0, new java.awt.Color(204, 204, 204)));
        title.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel2.setFont(new java.awt.Font("Helvetica Neue", 1, 22)); // NOI18N
        jLabel2.setForeground(new java.awt.Color(35, 36, 37));
        jLabel2.setText("Agenda semanal");
        title.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 0, -1, 60));

        add(title, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 1080, 60));

        weekPanel.setBackground(new java.awt.Color(255, 255, 255));
        add(weekPanel, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 60, 1080, 625));
    }// </editor-fold>//GEN-END:initComponents


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel title;
    private static javax.swing.JPanel weekPanel;
    // End of variables declaration//GEN-END:variables
}
